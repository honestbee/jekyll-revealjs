### Implementation

---

![](/theme/db_schema.png)

---

### RESTful API

Orders end point
```http
GET     /orders
GET     /orders/:id
POST    /orders/
PUT     /orders/:id
DELETE  /orders/:id
```

Stores end point
```http
GET     /store
GET     /store/:id
GET     /store/:id/orders
POST    /store/
PUT     /store/:id
DELETE  /store/:id
```

Note:
- Jon decide to implement the API using the REST approach
- It's strait-forward, clean, and easy.

---

![](/theme/bed.png)

Note:
- Jon is happy
- Jon sleep well that night

---


Next task, implementing this page

![](/theme/order_page_raw.jpg)

---

Contains stores information

![](/theme/order_page_edited.jpg)

Note:
- As a front-end engineer, how should we implement this?

---

First we need to get a list of orders:

```
GET /orders
```

```json
[
    {
        id: 1,
        status: "delivering",
        store_id: 101
    },
    {
        id: 2,
        status: "processing",
        store_id: 102
    },
    ...
]
```

---

Next we try to get the related stores data:

```
GET /stores/101
GET /stores/102
GET /stores/103
GET /stores/104
GET /stores/105
GET /stores/106
GET /stores/107
GET /stores/108
GET /stores/109
GET /stores/110
GET /stores/111
GET /stores/112
...
```

---

### Issue?

# Multiple round trip {% fragment %}

Note:
- Ask audiences for answer
- And that is I have stop at store, I haven't query country, user, and timeslot information.
- Impact? web is slow, mobile app is slow, mobile customer waste a ton of data, customer are angry -> Jon is sad

---

### Solution?

Loading the related information and return them in the same API call. {% fragment %}

    GET /orders
{% fragment %}

```
[
    {
        id: 1,
        status: "delivering"
        store: {
            id: 101,
            name: "Fair Price"
        }
    },
    ...
]
```
{% fragment %}

Note:
- Ask for answer

---

### Issue?

## Over fetching data that we don't event need {% fragment %}

Note:
- Ask for answer
- The issue with this is for most of the time we will over fetching data that we don't event need.
- Impact: queries are slower in average, web and app are unresponsive due to every request are heavy, customer waste a bit more time, a bit more data. Customers are not happy -> Jon is a little bit sad

---

### Solution?

## Customized end-points {% fragment %}

```
GET order/
```
{% fragment %}
```
GET order_with_store/
```
{% fragment %}
```
GET order_for_admin_panel/
```
{% fragment %}
```
GET order_with_store_and_country_and_timeslot/
```
{% fragment %}
```
GET order_with_store_and_country_and_timeslot_and_customer/
```
{% fragment %}
```
GET order_with_everything/
...
```
{% fragment %}

---

### Current state of honestbee
![](/theme/seriallizers.jpg)

Note:
- There are so many variations of OrderFulfillment payload that need to be maintained

---

### Custom end-point are hard to maintain

![](theme/fulfillment_detail_seriallizer.jpg)

Note:
- Naming them are so hard that sometimes it does make sense

---

### Custom end-point are hard to maintain

![](theme/misuse_fulfillment_seriallizer.jpg)

Note:
- And you think this class is used somewhere in admin panel, but no, it is used in public facing api that serve our mobile app and web client

---

### How about development time?

---

#### Mobile client ask for data
![](theme/mobile_client_ask_for_data.jpg)

![](theme/mobile_client_send_custom_request.jpg) {% fragment %}

Note:
- Once the request sent, it need to be planned into a sprint, then it need to be implemented

---

### Back-end fulfill custom api request
![](theme/backend_custom_api.jpg)

Note:
- After implementing, the code need to be review, then it need to be tested by QA before offically being deployed

---

### Issue?

- Back-end:
  - Increase the complexity of the API implementation and maintaining effort
  - Increase the complexity of the API documentation
- Front-end:
  - Add unnecessary blocker to the workflow
- Project Manager:
  - Feature being delayed 1-2 weeks due to dependencies between teams

Note:
- This leads to? Jon is sad

---

{% background red %}

### But Jon doesn't want to be sad!!!

![](/theme/quest_finding_solution.jpg) {% fragment %}

Note:
- Before help Jon find out the solution let's summary what are the drawbacks of REST.

---

{% background red %}

### REST drawbacks:

- Multiple round trip
- Over-fetching data
- Too many custom end point
- Slow to fulfill request from api users












